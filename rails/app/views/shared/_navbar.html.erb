<nav class="navbar-custom" id="mainNavbar" data-controller="navbar-scroll">
  <div class="navbar-container">
    

    <!-- Navigation principale -->
    <div class="navbar-nav">
      <%= link_to root_path, class: "nav-item #{'active' if current_page?(root_path)}" do %>
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Accueil</span>
      <% end %>

      <%= link_to events_path, class: "nav-item #{'active' if current_page?(events_path)}" do %>
        <span class="nav-icon">üìÖ</span>
        <span class="nav-label">Liste</span>
      <% end %>

      <%= link_to my_events_path, class: "nav-item #{'active' if current_page?(my_events_path)}" do %>
        <span class="nav-icon">üéØ</span>
        <span class="nav-label">Mes filtres</span>
      <% end %>

      <%= link_to home_infos_path, class: "nav-item #{'active' if current_page?(home_infos_path)}" do %>
        <span class="nav-icon">üí¨</span>
        <span class="nav-label">Aide</span>
      <% end %>

      <!-- Bouton Profil / Se connecter -->
      <% if user_signed_in? %>
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="nav-item flex items-center gap-2 cursor-pointer">
            <span class="nav-icon" style="color:brown ;">
              <i class="fas fa-user"></i>
            </span>
            <span class="nav-label">Profil</span>
          </label>

          <ul tabindex="0" class="dropdown-content z-[1] menu menu-vertical menu-start p-2 shadow bg-base-100 rounded-box w-52">
            <li>
              <%= link_to "Mon profil", profile_path, 
                  class: "btn btn-ghost w-full justify-start py-2" %>
            </li>
            <li>
    <%= link_to "Se d√©connecter", destroy_user_session_path, 
        data: { turbo_method: :delete },
        class: "btn btn-ghost w-full justify-start py-2" %>            </li>
          </ul>
        </div>
      <% else %>
        <%= link_to new_user_session_path, class: "nav-item #{'active' if current_page?(new_user_session_path)}" do %>
          <span class="nav-icon" style="color:brown ;">
            <i class="fas fa-user"></i>
          </span>
          <span class="nav-label">Se connecter</span>
        <% end %>
      <% end %>

    </div>
    
  </div>

  <!-- Script pour forcer l'initialisation des dropdowns et choisir la direction dynamiquement -->
  <script>
    document.addEventListener("turbo:load", function() {
      const dropdowns = document.querySelectorAll('.dropdown');
      dropdowns.forEach(dropdown => {
        const label = dropdown.querySelector('label[tabindex="0"]');
        if (!label) return;

        label.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Toggle dropdown-open
          dropdown.classList.toggle('dropdown-open');

          // V√©rifier si le dropdown est en bas de la page
          const rect = label.getBoundingClientRect();
          const windowHeight = window.innerHeight;
          const dropdownMenu = dropdown.querySelector('.dropdown-content');
          if (!dropdownMenu) return;

          const menuHeight = dropdownMenu.offsetHeight;
          const spaceBelow = windowHeight - rect.bottom;

          // Si peu d'espace en dessous ‚Üí ouvrir vers le haut
          if (spaceBelow < menuHeight) {
            dropdown.classList.add('dropdown-top');
            dropdown.classList.remove('dropdown-bottom');
          } else {
            dropdown.classList.add('dropdown-bottom');
            dropdown.classList.remove('dropdown-top');
          }
        });
      });
    });
  </script>
</nav>