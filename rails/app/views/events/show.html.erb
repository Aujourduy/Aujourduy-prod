<div class="container mx-auto p-6">
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <div class="flex justify-between items-start mb-6">
        <h1 class="card-title text-4xl"><%= @event.title %></h1>
        
        <% if user_signed_in? && @event.user == current_user %>
          <div class="dropdown dropdown-end">
            <label tabindex="0" class="btn btn-ghost btn-circle">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01"></path></svg>
            </label>
            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
              <li><%= link_to "Modifier l'√©v√©nement", edit_event_path(@event) %></li>
              <li><%= link_to "Supprimer", @event, method: :delete, confirm: "√ätes-vous s√ªr ?" %></li>
            </ul>
          </div>
        <% end %>
      </div>
      
      <% if @event.description.present? %>
        <div class="prose max-w-none mb-6">
          <%= simple_format(@event.description) %>
        </div>
      <% end %>
      
      <!-- URL de r√©f√©rence (TOUJOURS AFFICH√âE) -->
      <div class="alert alert-info mb-6">
        <div class="w-full">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <h3 class="font-bold">
                <%= @event.scraped? ? "üì° √âv√©nement scrap√©" : "üîó Source de l'√©v√©nement" %>
              </h3>
              <%= link_to @event.source_url, @event.source_url, 
                  target: "_blank", 
                  class: "text-sm link link-primary break-all" %>
              <% if @event.scraped? %>
                <div class="text-xs opacity-70 mt-1">
                  Import√© depuis : <%= @event.teacher_url.display_name %>
                </div>
              <% end %>
            </div>
            <% if @event.scraped? %>
              <div class="badge badge-success flex-shrink-0 ml-2">Automatique</div>
            <% else %>
              <div class="badge badge-info flex-shrink-0 ml-2">Manuel</div>
            <% end %>
          </div>
        </div>
      </div>
      
      <div class="stats shadow mb-6">
        <div class="stat">
          <div class="stat-title">Type</div>
          <div class="stat-value text-lg">
            <div class="badge <%= @event.is_recurring? ? 'badge-secondary' : 'badge-accent' %>">
              <%= @event.is_recurring? ? "R√©current" : "Unique" %>
            </div>
          </div>
        </div>
        
        <div class="stat">
          <div class="stat-title">Prix normal</div>
          <div class="stat-value text-2xl text-success"><%= @event.formatted_price_normal %></div>
        </div>
        
        <div class="stat">
          <div class="stat-title">Prix r√©duit</div>
          <div class="stat-value text-xl text-info"><%= @event.formatted_price_reduced %></div>
        </div>
        
        <div class="stat">
          <div class="stat-title">Occurrences</div>
          <div class="stat-value text-2xl"><%= @event.occurrences_count %></div>
        </div>
      </div>
      
      <% if @event.principal_teacher %>
        <div class="alert alert-info mb-6">
          <div>
            <h3 class="font-bold">Professeur principal</h3>
            <div class="text-xs"><%= @event.principal_teacher_name %></div>
          </div>
        </div>
      <% end %>
      
      <% if @upcoming_occurrences.any? %>
        <div class="divider text-xl">Prochaines dates</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% @upcoming_occurrences.each do |occurrence| %>
            <div class="card bg-base-200 compact">
              <div class="card-body">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <h4 class="card-title text-lg"><%= occurrence.effective_title %></h4>
                    <p><%= occurrence.formatted_datetime %></p>
                    <div class="text-sm opacity-70">üìç <%= occurrence.venue.name %></div>
                    <div class="text-sm opacity-70">üë®‚Äçüè´ <%= occurrence.teachers_names %></div>
                    
                    <% if occurrence.has_any_override? %>
                      <div class="badge badge-warning badge-sm mt-2">Modifi√©e</div>
                    <% end %>
                  </div>
                  
                  <% if user_signed_in? && @event.user == current_user %>
                    <%= link_to "‚úèÔ∏è", edit_event_occurrence_path(occurrence), class: "btn btn-ghost btn-sm btn-circle", title: "Modifier cette occurrence" %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  
  <div class="mt-6">
    <%= link_to events_path, class: "btn btn-ghost" do %>
      ‚Üê Retour aux √©v√©nements
    <% end %>
  </div>
</div>
