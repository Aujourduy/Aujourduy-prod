<%= form_with model: current_user, url: profile_path, method: :patch, local: true, class: "space-y-6" do |f| %>

  <!-- Villes favorites -->
  <%= render 'shared/searchable_checkboxes',
    form: f,
    title: "üìç Villes favorites",
    description: "S√©lectionnez les villes o√π vous souhaitez voir les √©v√©nements",
    field_name: :favorite_cities,
    items: @available_cities,
    search_key: "city",
    search_placeholder: "üîç Rechercher une ville...",
    badge_class: "badge-primary",
    selected_label: "Villes s√©lectionn√©es :",
    checked: ->(city) { current_user.favorite_cities.include?(city) },
    selected_items: -> { current_user.favorite_cities },
    with_hidden_field: true
  %>

  <!-- Pays favoris -->
  <%= render 'shared/searchable_checkboxes',
    form: f,
    title: "üåç Pays favoris",
    description: "S√©lectionnez les pays o√π vous souhaitez voir les √©v√©nements",
    field_name: :favorite_countries,
    items: @available_countries,
    search_key: "country",
    search_placeholder: "üîç Rechercher un pays...",
    badge_class: "badge-secondary",
    selected_label: "Pays s√©lectionn√©s :",
    checked: ->(country) { current_user.favorite_countries.include?(country) },
    selected_items: -> { current_user.favorite_countries },
    with_hidden_field: true
  %>

  <!-- Professeurs favoris -->
  <%= render 'shared/searchable_checkboxes',
    form: f,
    title: "üë®‚Äçüè´ Professeurs favoris",
    description: "S√©lectionnez les professeurs que vous souhaitez suivre",
    field_name: :favorite_teacher_ids,
    items: @available_teachers,
    search_key: "teacher",
    search_placeholder: "üîç Rechercher un professeur...",
    badge_class: "badge-accent",
    selected_label: "Professeurs s√©lectionn√©s :",
    item_display: ->(teacher) { "#{teacher.first_name} #{teacher.last_name}" },
    item_value: ->(teacher) { teacher.id },
    item_search_value: ->(teacher) { "#{teacher.first_name} #{teacher.last_name}".downcase },
    checked: ->(teacher) { current_user.favorite_teacher_ids.include?(teacher.id) },
    selected_items: -> { Teacher.where(id: current_user.favorite_teacher_ids) },
    with_hidden_field: true
  %>

  <!-- Pratiques favorites -->
  <%= render 'shared/searchable_checkboxes',
    form: f,
    title: "üé® Pratiques favorites",
    description: "S√©lectionnez les pratiques de danse qui vous int√©ressent",
    field_name: :favorite_practice_ids,
    items: @available_practices,
    search_key: "practice",
    search_placeholder: "üîç Rechercher une pratique...",
    badge_class: "badge-info",
    selected_label: "Pratiques s√©lectionn√©es :",
    item_display: ->(practice) { practice.name },
    item_value: ->(practice) { practice.id },
    item_search_value: ->(practice) { practice.name.downcase },
    checked: ->(practice) { current_user.favorite_practice_ids.include?(practice.id) },
    selected_items: -> { Practice.where(id: current_user.favorite_practice_ids) },
    with_hidden_field: true
  %>
  
  <!-- Mots-cl√©s de recherche -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">üîç Mots-cl√©s</h2>
      <p class="text-sm text-base-content/70 mb-4">
        Ajoutez des mots-cl√©s pour filtrer les √©v√©nements (ex: "salsa contact d√©butant")
      </p>
      
      <%= f.text_field :search_keywords, 
          class: "input input-bordered w-full placeholder:text-base-content/40", 
          placeholder: "salsa contact d√©butant..." %>
      
      <p class="text-xs text-base-content/60 mt-2">
        ‚ÑπÔ∏è Tous les mots seront recherch√©s dans les titres et descriptions (ordre libre)
      </p>
    </div>
  </div>
  
  <!-- Bouton sauvegarder -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <%= f.submit "üíæ Enregistrer mes pr√©f√©rences", class: "btn btn-primary btn-lg w-full" %>
    </div>
  </div>
  
<% end %>
